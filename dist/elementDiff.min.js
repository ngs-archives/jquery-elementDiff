/*! jQuery Element Diff - v0.2.1 - 2014-05-01
 * https://github.com/ngs/jquery-elementDiff
 * Copyright (c) 2014 Atsushi Nagase; Licensed MIT */
(function(){!function(a){"use strict";var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u;return c="\n",p=a.map,h=a.extend,m=a.inArray,q=a.merge,u=a.trim,f=function(a){return h({},a)},n=function(a){var b;if(!a||"object"!=typeof a)return!1;for(b in a)if(Object.prototype.hasOwnProperty.call(a,b))return!1;return!0},k=function(a){var b;return b=a.filter(function(){return 1!==this.nodeType||"IFRAME"!==this.nodeName}).contents().filter(function(){return 3===this.nodeType&&u(this.data)}).get(),p(b,function(a){return u(a.data)})},l=function(a){return k(a).length>0},g=function(a){return a.replace(/(")/g,"\\$1")},j=function(a){return'$("'+g(a)+'")'},t=function(a,b){return""+a+" > :eq("+b+")"},d=/^(string|number|boolean|undefined)$/,o=function(a){return!a||d.test(typeof a)||a instanceof Array},r=function(a){var b,c;if(o(a))return null;for(b in a)c=a[b],a[b]=r(c);return a},e=function(a,b){var c,d,g,i,j;a=f(a),b=f(b),c={};for(d in a)i=a[d],j=b[d],delete b[d],o(j)&&o(i)?j!==i&&(c[d]=j):"object"==typeof j?(g=e(i,j),n(g)||(c[d]=g)):c[d]=r(i);return h(c,b)},i=function(a,b,c){var d,e;null==b&&(b={}),null==c&&(c=null);for(d in a)e=a[d],"_"===d?d=c:c&&(d=""+c+"-"+d),o(e)?b[d]=e:i(e,b,d);return b},s=function(b){var c;return c=a("<div />").append(b.clone()),u(c.html()).replace(/>\s*\n\s*</g,"><")},b=function(){function b(a,b){"undefined"==typeof b&&(b=a.selector),this.element=a,this.selector=b}return b.prototype.toString=function(){return"[ElementDiff: "+(this.selector||this.element[0])+"]"},b.diffObjects=e,b.flattenAttributes=i,b.getTextContents=k,b.hasTextNode=l,b.isEmptyObject=n,b.nullDeeply=r,b.outerHTML=s,b.prototype.hasTextDiff=function(b){var d,e;return d=k(a(this.element)),e=k(a(b)),d.join(c)!==e.join(c)},b.prototype.generateCode=function(a){var b,c;return b=q([],arguments).slice(1),c=p(b,function(a){return JSON.stringify(a)}).join(","),""+a+"("+c+")"},b.prototype.diffAttributes=function(b){var c,d,f,g,h;b=a(b),c=this.element.attr(),d=b.attr(),f=i(e(c,d));for(g in f)h=f[g],void 0===h&&(f[g]=null);return n(f)?[]:[this.generateCode("attr",f)]},b.prototype.diffText=function(b){var c,d,e,f,g,h,i,j;return f=this.element,b=a(b),c=f.children(),d=b.children(),i=c.size(),j=d.size(),g=f.html(),h=b.html(),e=[],this.hasTextDiff(b)?(e.push(this.generateCode("html",h)),e):e},b.prototype.isSameTag=function(b){var c;return c="nodeName",b=a(b),1===b.size()&&this.element.prop(c)===b.prop(c)},b.prototype.diff=function(b){var c,d,e,f,g,h;return e=this.element,h=b,f=e.is("body"),g=!1,"string"==typeof b&&(b=b.replace(/<(\/?)body([^>]*)>/gi,"<$1div$2>"),g=h!==b),b=a(b),b&&b.size()?(d=[],f?g?(q(d,this.diffAttributes(b)),d.push(this.generateCode("html",b.html()))):d.push(this.generateCode("html",h)):this.isSameTag(b)?(q(d,this.diffAttributes(b)),q(d,this.diffText(b))):d.push(this.generateCode("replaceWith",s(b))),d.length?(c=d.join("."),this.selector?[""+j(this.selector)+"."+c]:[c]):[]):[]},b.prototype.diffRecursive=function(c){var d,e,f,g,h,i,k,l,m,n,o,p;if(m=this,g=m.element,c=a(c),k=m.diff(c),!this.isSameTag(c))return k;if(k[0]&&(p=g.clone(),h=k[0].replace(/^\$\("(.*?)"\)\./,"ele."),new Function("ele",h).call(this,p),p.html()!==g.html()))return k;for(f=[],l=m.selector,d=g.children(),e=c.children(),n=d.size(),o=e.size(),e.each(function(c){var g,h;return g=a(d[c]),h=a(e[c]),g.size()?q(f,new b(g,t(l,c)).diffRecursive(h)):f.push(""+j(l)+"."+m.generateCode("append",s(h)))}),i=n;i>o;)f.push(""+j(t(l,--i))+"."+m.generateCode("remove"));return q(f,k),f},b}(),a.elementDiff=b,h(a.fn,{elementDiff:function(a){return new b(this,a)},getElementDiff:function(a,b){return this.elementDiff(b).diffRecursive(a)}}),this}(jQuery)}).call(this);